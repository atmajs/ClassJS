(function(t){function n(t,n){if(t instanceof Array)for(var e=0,r=t.length;r>e;e++)n(t[e],e);else n(t)}function e(t){"function"==typeof t&&(t=t.prototype);for(var n,e,r=1,i=arguments.length;i>r;r++){n="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(e in n)if("Static"!==e||null==t.Static)t[e]=n[e];else for(e in t.Static)t.Static[e]=t.Static[e]}return t}"function"!=typeof Array.isArray&&(Array.isArray=function(t){return t instanceof Array?!0:null==t||"object"!=typeof t?!1:void 0!==t.length&&"function"==typeof t.slice});var r=function(){function t(t,n){if(null!=n){"function"==typeof t&&(t=t.prototype);for(var e in n)t[e]=n[e]}}function e(t,n,e){var r=t[n],i=function(t){return s(t)?r.apply(this,arguments):r.apply(this,arguments)};return function(){this.super=i,e.apply(this,arguments)}}function r(r,i,o,s,u){var l=s,c=s;if(l.constructor=r.prototype.constructor,null!=o&&(c.__proto__={},n(o,function(n){t(c.__proto__,n)}),c=c.__proto__),null!=i&&(c.__proto__=i.prototype),null!=u)for(var a in u)e(l,a,u[a]);r.prototype=l}function i(e,r,i,o){if(null!=r){var s=function(){};s.prototype=r.prototype,e.prototype=new s,e.prototype.constructor=e}t(e.prototype,o),null!=i&&n(i,function(n){var r={};t(r,n),delete r.constructor;for(var i in r)e.prototype[i]=r[i]})}var o=Object.prototype.toString,s=function(t){return"[object Arguments]"===o.call(t)};return"__proto__"in Object.prototype==!0?r:i}(),i=function(t,n){if(null!=n)if("function"!=typeof n)if(Array.isArray(n))for(var e=n.length,r=0;0!==e--;)i(t,n[r++]);else if(n.Static){n=n.Static;for(var o in n)n.hasOwnProperty(o)&&null==t[o]&&(t[o]=n[o])}else;else for(var o in n)"function"==typeof n[o]&&n.hasOwnProperty(o)&&null==t[o]&&(t[o]=n[o])},o={toJSON:function(){var t,n,e={};for(t in this)95!==t.charCodeAt(0)&&"Static"!==t&&(n=this[t],null!=n&&"function"!=typeof n&&(e[t]=n));return e}},s={};n(["get","del"],function(t){s[t]=function(n,e){this.promise[t](n).then(function(t,n){return t?(e.onError(t,n),void 0):(e.onSuccess(n),void 0)})}}),n(["post","put"],function(t){s[t]=function(n,e,r){this.promise[t](n,e).then(function(t,n){r(t,n)})}}),function(t){function n(t,n){return function(){return t.apply(n,arguments)}}function e(){this._callbacks=[]}function r(t){function n(t){return function(n,e){i+=1,s[t]=n,u[t]=e,i===r&&o.done(s,u)}}for(var r=t.length,i=0,o=new e,s=[],u=[],l=0;r>l;l++)t[l]().then(n(l));return o}function i(t,n,r){var o=new e;return 0===t.length?o.done(n,r):t[0](n,r).then(function(n,e){t.splice(0,1),i(t,n,e).then(function(t,n){o.done(t,n)})}),o}function o(t){var n="";if("string"==typeof t)n=t;else{var e=encodeURIComponent;for(var r in t)t.hasOwnProperty(r)&&(n+="&"+e(r)+"="+e(t[r]))}return n}function s(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){t=new ActiveXObject("Microsoft.XMLHTTP")}return t}function u(n,r,i,u){function l(){c.abort(),f.done(t.promise.ETIMEOUT,"")}var c,a,f=new e;i=i||{},u=u||{};try{c=s()}catch(h){return f.done(-1,""),f}a=o(i),"GET"===n&&a&&(r+="?"+a,a=null),c.open(n,r),c.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var p in u)u.hasOwnProperty(p)&&c.setRequestHeader(p,u[p]);var y=t.promise.ajaxTimeout;if(y)var v=setTimeout(l,y);return c.onreadystatechange=function(){y&&clearTimeout(v),4===c.readyState&&(200===c.status?f.done(null,c.responseText):f.done(c.status,c.responseText))},c.send(a),f}function l(t){return function(n,e,r){return u(t,n,e,r)}}e.prototype.then=function(t,e){var r=n(t,e);this._isdone?r(this.error,this.result):this._callbacks.push(r)},e.prototype.done=function(t,n){this._isdone=!0,this.error=t,this.result=n;for(var e=0;this._callbacks.length>e;e++)this._callbacks[e](t,n);this._callbacks=[]};var c={Promise:e,join:r,chain:i,ajax:u,get:l("GET"),post:l("POST"),put:l("PUT"),del:l("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:0};"function"==typeof define&&define.amd?define(function(){return c}):t.promise=c}(s);var u=function(){function t(t){this.route=r(t)}function n(t){var n=o.exec(t);return n?{optional:"?"===(n[2]||n[3]),parts:[n[1],n[4]]}:(n=s.exec(t))?{optional:"?"===n[3],parts:[n[1],n[4],n[5]]}:(console.error("Paths breadcrumbs should be match by regexps"),{parts:[t]})}function e(t,e){for(var r=t.split(e),i=0,o=r.length;o>i;i++)r[i]=n(r[i]);return r}function r(t){var n=/[^\:\{]\?[^:]/.exec(t),r=null;return n&&(n=n.index+1,r=t.substring(n+1),t=t.substring(0,n)),{path:e(t,"/"),query:null==r?null:e(r,"&")}}function i(t,n,e){for(var r,i,o=[],s=0,u=t.length;u>s;s++)if(x=t[s],i=x.parts.slice(0),null!=i[1]){if(r=i[1],i[1]=n[r],null!=i[1])o.push(i.join(""));else if(!x.optional)return console.error("Object has no value, for not optional part - ",r),null}else o.push(i[0]);return o.join(e)}t.prototype={constructor:t,create:function(t){var n,e;return n=i(this.route.path,t,"/"),null==n?null:this.route.query&&(e=i(this.route.query,t,"&"),null==e)?null:n+(e?"?"+e:"")}};var o=/^([^:\?]*)(\??):(\??)([\w]+)$/,s=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return t}(),l={_isAsync:!0,_done:null,_fail:null,_always:null,_isResolved:!1,_isRejected:!1,deferr:function(){this._isRejected=!1,this._isResolved=!1},resolve:function(){this._fail=null,this._isResolved=!0;var t=this._done,n=t&&t.length,e=0;if(t){for(;0!==n--;)t[e++](this);this._done=null}if(t=this._always,n=t&&t.length,e=0,t){for(;0!==n--;)t[e++](this);this._always=null}return this},reject:function(){this._done=null,this._isRejected=!0;var t=this._fail,n=t&&t.length,e=0;if(t){for(;0!==n--;)t[e++](this);this._fail=null}if(t=this._always,n=t&&t.length,e=0,t){for(;0!==n--;)t[e++](this);this._always=null}return this},done:function(t){return this._isResolved?t(this):(this._done||(this._done=[])).push(t),this},fail:function(t){return this._isRejected?t(this):(this._fail||(this._fail=[])).push(t),this},always:function(t){return this._isRejected||this._isResolved?t(this):(this._always||(this._always=[])).push(t),this}},c=function(){function t(){this._listeners={}}return t.prototype={constructor:t,on:function(t,n){return(this._listeners[t]||(this._listeners[t]=[])).push(n),this},once:function(t,n){return n._once=!0,(this._listeners[t]||(this._listeners[t]=[])).push(n),this},pipe:function(t){var n,e=this,r=Array.prototype.slice;return function(){n=r.call(arguments),n.unshift(t),e.trigger.apply(e,n)}},trigger:function(){var t,n,e=Array.prototype.slice.call(arguments),r=e.shift(),i=this._listeners[r],o=0;if(null==i)return this;for(n=i.length;n>o;o++)t=i[o],t.apply(this,e),t._once===!0&&(i.splice(o,1),o--,length--);return this},off:function(t,n){if(null==this._listeners[t])return this;for(var e=this._listeners[t],r=e.length,i=0;r>i;i++)e[i]===n&&e.splice(i,1),i--,length--;return this}},t}(),a=function(){function t(t,n){return n instanceof t?n:new t(n)}function n(t,n){return function(){return this.length=0,this._constructor=n,null!=t?t.apply(this,arguments):this}}function r(t,r){return r.Construct=n(r.Construct,t),e(r,o,i),y(r)}var i=function(){function n(t,n){if(null==n)return!1;if("function"==typeof n)return n(t);if("object"==typeof n){var e,r;for(var i in n){if(e=t[i],r=n[i],"string"==typeof r){var o=r[0],s=1;if("<"===o||">"===o)switch("="===r[1]&&(o+="=",s++),r=r.substring(s),o){case"<":if(e>=r)return!1;continue;case"<=":if(e>r)return!1;continue;case">":if(r>=e)return!1;continue;case">=":if(r>e)return!1;continue}}if(e!=r)return!1}return!0}return console.warn("No valid matcher",n),!1}var e={push:function(n){return this[this.length++]=t(this._constructor,n),this},pop:function(){var t=this[--this.length];return this[this.length]=null,t},each:function(t,n){for(var e,r=0,i=array.length;i>r;r++)e=array[r],t.call(n||this,e,r)},where:function(t){for(var e,r=new this.constructor,i=0,o=this.length;o>i;i++)e=this[i],n(e,t)&&(r[r.length++]=e);return r},remove:function(t){for(var e=-1,r=[],i=0,o=this.length;o>i;i++)n(this[i],t)?r.push(this[i]):this[++e]=this[i];for(i=++e;o>i;i++)this[i]=null;return this.length=e,r},first:function(t){if(null==t)return this[0];for(var e=this.length,r=0;-1!==--e;)if(n(this[r++],t))return this[r-1];return null},last:function(t){if(null==t)return this[0];for(var e=this.length;-1!==--e;)if(n(this[e],t))return this[e];return null}};return e}(),o={serialize:function(){return JSON.stringify(this.toArray())},deserialize:function(n){for(var e=0,r=n.length;r>e;e++)this[this.length++]=t(this._constructor,n[e]);return this},del:function(t){if(null==t)return p.prototype.del.call(this),this;var n=this.remove(t);return 0===n.length?this:this.save()},toArray:function(){for(var t=Array(this.length),n=0,e=this.length;e>n;n++)t[n]=this[n];return t}};return r}(),f={deserialize:function(t){"string"==typeof t&&(t=JSON.parse(t));for(var n in t)this[n]=t[n];return this},serialize:function(){return JSON.stringify(this)},fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(t){return(new this).fetch(t)}}},h=function(){var t=function(t){this._route=new u(t)};return e(t,f,l,{fetch:function(t){return s.get(this._route.create(t||this),this),this},save:function(t){s.post(this._route.create(this),this.serialize(),t)},del:function(t){s.del(this._route.create(this),this.serialize(),t)},onSuccess:function(t){var n;try{n=JSON.parse(t)}catch(e){return this.onError(e),void 0}this.deserialize(n),this.resolve(this)},onError:function(t){this.reject({error:t})}}),function(n){return new t(n)}}(),p=function(){var t=function(t){this._route=new u(t)};return e(t,f,l,{fetch:function(t){var n=this._route.create(t||this),e=localStorage.getItem(n);if(null==e)return this.resolve(this),this;if("string"==typeof e)try{e=JSON.parse(e)}catch(r){this.onError(r)}return this.deserialize(e),this.resolve(this)},save:function(t){var n=this._route.create(this),e=this.serialize();return localStorage.setItem(n,e),t&&t(),this},del:function(t){var n=this._route.create(t||this);return localStorage.removeItem(n),this},onError:function(t){this.reject({error:t})}}),function(n){return new t(n)}}(),y=function(t){var n,e=t.Base,s=t.Extends,u=t.Static,l=t.Construct,c=null,a=t.Store,f=t.Override;if(null!=e&&delete t.Base,null!=s&&delete t.Extends,null!=u&&delete t.Static,null!=l&&delete t.Construct,null!=a&&delete t.Store,null!=f&&delete t.Override,null==s?s=a:Array.isArray(s)?s.push(a):s=[s,a],void 0===t.toJSON&&(t.toJSON=o.toJSON),null==e&&null==s){if(c=null==l?function(){}:l,t.constructor=c.prototype.constructor,null!=u)for(n in u)c[n]=u[n];return c.prototype=t,c}if(c=function(){if(null!=s)for(var t=s instanceof Array,n=t?s.length:1,r=null,i=0;t?n>i:1>i;i++)r=t?s[i]:s,"function"==typeof r&&r.apply(this,arguments);if(null!=e&&e.apply(this,arguments),null!=l){var o=l.apply(this,arguments);if(null!=o)return o}return this},null!=u)for(n in u)c[n]=u[n];return null!=e&&i(c,e),null!=s&&i(c,s),r(c,e,s,t,f),t=null,u=null,c};y.bind=function(t){for(var n,e=arguments,r=1,i=arguments.length;i>r;r++)n=e[r],t[n]=t[n].bind(t);return t},y.Remote=h,y.LocalStore=p,y.Deferred=l,y.EventEmitter=c,y.Collection=a,t.Class=y})("undefined"!=typeof window&&null!=window.document||"undefined"==typeof global?window:global);