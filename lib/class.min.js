(function(t,n){"use strict";var r,e;"undefined"==typeof exports||t!==exports&&null!=t||(r=e=global),null==r&&(r="undefined"==typeof window?global:window),null==e&&(e=t||r),n(r,e)})(this,function(t,n){"use strict";function r(t){return"function"==typeof t}function e(t){return"string"==typeof t}function i(t,n){if(o(t))for(var r=0,e=t.length;e>r;r++)n(t[r],r);else n(t)}function o(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice}function u(t){return"function"==typeof t?t.prototype:t}function s(t,n,r){var e,o;for(e in t)o=t[e],c(o)&&(null!=n&&c(n.prototype[e])&&f(o,n.prototype[e]),null!=r&&i(r,function(t){t=u(t),c(t[e])&&f(o,t[e])}))}function l(t){"function"==typeof t&&(t=t.prototype);for(var n,r,e=1,i=arguments.length;i>e;e++){n="function"==typeof arguments[e]?arguments[e].prototype:arguments[e];for(r in n)if("Static"!==r||null==t.Static)t[r]=n[r];else for(r in t.Static)t.Static[r]=t.Static[r]}return t}function a(t,n){if("object"!=typeof t||null==n)return t;for(var r,e=t,i=n.split("."),o=i.length,u=0;o>u;u++)if(r=i[u],e=e[r],null==e)return e;return e}function c(t){return null==t?!1:"object"!=typeof t?!1:t.constructor===Object}function f(t,n){for(var r in n)null==t[r]&&(t[r]=n[r]);return t}function h(t,n){for(var r in n)n[r]&&(t[r]=n[r]);return t}function p(t,n){return function(){switch(arguments.length){case 1:return t.call(n,arguments[0]);case 2:return t.call(n,arguments[0],arguments[1]);case 3:return t.call(n,arguments[0],arguments[1],arguments[2]);case 4:return t.call(n,arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return t.call(n,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}return t.apply(n,arguments)}}function g(t){if(this instanceof g==!1){var n=function(t){g.call(this,t)};return n.prototype._props=t,h(n.prototype,g.prototype),n}null!=t&&this.deserialize(t)}var y=Array.prototype.slice,v=Array.prototype.sort;"function"!=typeof Array.isArray&&(Array.isArray=function(t){return t instanceof Array?!0:null==t||"object"!=typeof t?!1:void 0!==t.length&&"function"==typeof t.slice});var d=function(){function t(t,n){if(null!=n){"function"==typeof t&&(t=t.prototype),"function"==typeof n&&(n=n.prototype);for(var r in n)t[r]=n[r]}}function n(t,n,r){var e=t[n],i=null==e?function(){}:function(t){return s(t)?e.apply(this,t):e.apply(this,arguments)};return function(){return this.super=i,r.apply(this,arguments)}}function r(r,e,u,s,l){var a=s,c=s;if(a.constructor=r.prototype.constructor,null!=u&&(c[o]={},i(u,function(n){t(c[o],n)}),c=c[o]),null!=e&&(c[o]=e.prototype),null!=l)for(var f in l)a[f]=n(a,f,l[f]);r.prototype=a}function e(n,r,e,o){if(null!=r){var u=function(){};u.prototype=r.prototype,n.prototype=new u,n.prototype.constructor=n}t(n.prototype,o),null!=e&&i(e,function(r){var e={};t(e,r),delete e.constructor;for(var i in e)n.prototype[i]=e[i]})}var o="__proto__",u=Object.prototype.toString,s=function(t){return"[object Arguments]"===u.call(t)};return"__proto__"in Object.prototype==!0?r:e}(),m=function(t,n){if(null!=n)if("function"!=typeof n)if(Array.isArray(n))for(var r=n.length,e=0;0!==r--;)m(t,n[e++]);else if(n.Static){n=n.Static;for(var i in n)n.hasOwnProperty(i)&&null==t[i]&&(t[i]=n[i])}else;else for(var i in n)"function"==typeof n[i]&&n.hasOwnProperty(i)&&null==t[i]&&(t[i]=n[i])},_={toJSON:function(){var t,n,r={};for(t in this)95!==t.charCodeAt(0)&&"Static"!==t&&"Validate"!==t&&(n=this[t],null!=n&&"function"!=typeof n&&(r[t]=n));return r}},w={};i(["get","del"],function(t){w[t]=function(n,r){this.promise[t](n).then(function(t,n){return t?(r.onError(t,n),void 0):(r.onSuccess(n),void 0)})}}),i(["post","put"],function(t){w[t]=function(n,r,e){this.promise[t](n,r).then(function(t,n){e(t,n)})}}),function(t){function n(t,n){return function(){return t.apply(n,arguments)}}function r(){this._callbacks=[]}function e(t){function n(t){return function(n,r){i+=1,u[t]=n,s[t]=r,i===e&&o.done(u,s)}}for(var e=t.length,i=0,o=new r,u=[],s=[],l=0;e>l;l++)t[l]().then(n(l));return o}function i(t,n,e){var o=new r;return 0===t.length?o.done(n,e):t[0](n,e).then(function(n,r){t.splice(0,1),i(t,n,r).then(function(t,n){o.done(t,n)})}),o}function o(t){var n="";if("string"==typeof t)n=t;else{var r=encodeURIComponent;for(var e in t)t.hasOwnProperty(e)&&(n+="&"+r(e)+"="+r(t[e]))}return n}function u(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){t=new ActiveXObject("Microsoft.XMLHTTP")}return t}function s(n,e,i,s){function l(){a.abort(),f.done(t.promise.ETIMEOUT,"")}var a,c,f=new r;i=i||{},s=s||{};try{a=u()}catch(h){return f.done(-1,""),f}c=o(i),"GET"===n&&c&&(e+="?"+c,c=null),a.open(n,e),a.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var p in s)s.hasOwnProperty(p)&&a.setRequestHeader(p,s[p]);var g=t.promise.ajaxTimeout;if(g)var y=setTimeout(l,g);return a.onreadystatechange=function(){g&&clearTimeout(y),4===a.readyState&&(200===a.status?f.done(null,a.responseText):f.done(a.status,a.responseText))},a.send(c),f}function l(t){return function(n,r,e){return s(t,n,r,e)}}r.prototype.then=function(t,r){var e=n(t,r);this._isdone?e(this.error,this.result):this._callbacks.push(e)},r.prototype.done=function(t,n){this._isdone=!0,this.error=t,this.result=n;for(var r=0;this._callbacks.length>r;r++)this._callbacks[r](t,n);this._callbacks=[]};var a={Promise:r,join:e,chain:i,ajax:s,get:l("GET"),post:l("POST"),put:l("PUT"),del:l("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:0};"function"==typeof define&&define.amd?define(function(){return a}):t.promise=a}(w),g.prototype={constructor:g,serialize:function(){return JSON.stringify(this)},deserialize:function(t){e(t)&&(t=JSON.parse(t));var n,i,o=this._props;for(n in t){if(null!=o&&(i=o[n],null!=i)){if(r(i)){this[n]=new i(t[n]);continue}var u=i.deserialize;if(r(u)){this[n]=u(t[n]);continue}}this[n]=t[n]}return this}};var S=function(){function t(t){this.route=e(t)}function n(t){var n=o.exec(t);return n?{optional:"?"===(n[2]||n[3]),parts:[n[1],n[4]]}:(n=u.exec(t))?{optional:"?"===n[3],parts:[n[1],n[4],n[5]]}:(console.error("Paths breadcrumbs should be match by regexps"),{parts:[t]})}function r(t,r){for(var e=t.split(r),i=0,o=e.length;o>i;i++)e[i]=n(e[i]);return e}function e(t){var n=/[^\:\{]\?[^:]/.exec(t),e=null;return n&&(n=n.index+1,e=t.substring(n+1),t=t.substring(0,n)),{path:r(t,"/"),query:null==e?null:r(e,"&")}}function i(t,n,r){for(var e,i,o,u=[],s=0,l=t.length;l>s;s++)if(o=t[s],i=o.parts.slice(0),null!=i[1]){if(e=i[1],i[1]=n[e],null!=i[1])u.push(i.join(""));else if(!o.optional)return console.error("Object has no value, for not optional part - ",e),null}else u.push(i[0]);return u.join(r)}t.prototype={constructor:t,create:function(t){var n,r;return n=i(this.route.path,t,"/"),null==n?null:this.route.query&&(r=i(this.route.query,t,"&"),null==r)?null:n+(r?"?"+r:"")}};var o=/^([^:\?]*)(\??):(\??)([\w]+)$/,u=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return t}(),b={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,deferr:function(){this._rejected=null,this._resolved=null},resolve:function(){this._fail=null,this._resolved=arguments;var t=this._done,n=t&&t.length,r=0;if(t){for(;0!==n--;)t[r++].apply(this,arguments);this._done=null}if(t=this._always,n=t&&t.length,r=0,t){for(;0!==n--;)t[r++].apply(this,this);this._always=null}return this},reject:function(){this._done=null,this._rejected=arguments;var t=this._fail,n=t&&t.length,r=0;if(t){for(;0!==n--;)t[r++].apply(this,arguments);this._fail=null}if(t=this._always,n=t&&t.length,r=0,t){for(;0!==n--;)t[r++].apply(this,this);this._always=null}return this},done:function(t){return null!=this._resolved?t.apply(this,this._resolved):(this._done||(this._done=[])).push(t),this},fail:function(t){return null!=this._rejected?t.apply(this,this._rejected):(this._fail||(this._fail=[])).push(t),this},always:function(t){return null!=this._rejected||null!=this._resolved?t.apply(this,this):(this._always||(this._always=[])).push(t),this}},j=function(){function t(){this._listeners={}}return t.prototype={constructor:t,on:function(t,n){return(this._listeners[t]||(this._listeners[t]=[])).push(n),this},once:function(t,n){return n._once=!0,(this._listeners[t]||(this._listeners[t]=[])).push(n),this},pipe:function(t){var n,r=this,e=Array.prototype.slice;return function(){n=e.call(arguments),n.unshift(t),r.trigger.apply(r,n)}},trigger:function(){var t,n,r=Array.prototype.slice.call(arguments),e=r.shift(),i=this._listeners[e],o=0;if(null==i)return this;for(n=i.length;n>o;o++)t=i[o],t.apply(this,r),t._once===!0&&(i.splice(o,1),o--,length--);return this},off:function(t,n){if(null==this._listeners[t])return this;for(var r=this._listeners[t],e=r.length,i=0;e>i;i++)r[i]===n&&r.splice(i,1),i--,length--;return this}},t}(),O=function(){function t(t,r){if("function"==typeof r)return r.call(t);var e;for(var i in r)if(e=n(t,i,r[i]))return e}function n(t,n,r){var e=a(t,n);return r.call(t,e)}function r(n){var r;return null!=n.Validate&&(r=t(n,n.Validate))?r:void 0}return{validate:r}}(),A=function(){function t(t,n){return n instanceof t?n:new t(n)}function n(t,n){return function(){return this.length=0,this._constructor=n,null!=t?t.apply(this,arguments):this}}function r(t,r){return r.Construct=n(r.Construct,t),l(r,i,e),z(r)}var e=function(){function n(t,n){if(null==n)return!1;if("function"==typeof n)return n(t);if("object"==typeof n){if(t.constructor===n.constructor&&t.constructor!==Object)return t===n;var r,e;for(var i in n){if(r=t[i],e=n[i],"string"==typeof e){var o=e[0],u=1;if("<"===o||">"===o)switch("="===e[1]&&(o+="=",u++),e=e.substring(u),o){case"<":if(r>=e)return!1;continue;case"<=":if(r>e)return!1;continue;case">":if(e>=r)return!1;continue;case">=":if(e>r)return!1;continue}}if(r!=e)return!1}return!0}return console.warn("No valid matcher",n),!1}var r={push:function(){for(var n=0,r=arguments.length;r>n;n++)this[this.length++]=t(this._constructor,arguments[n]);return this},pop:function(){var t=this[--this.length];return this[this.length]=null,t},shift:function(){if(0===this.length)return null;for(var t=this[0],n=this.length-1,r=0;n>r;r++)this[r]=this[r+1];return this[n]=null,this.length--,t},unshift:function(n){this.length++;for(var r=this.length;--r;)this[r]=this[r-1];return this[0]=t(this._constructor,n),this},splice:function(n,r){var e,i,o;if(n>=this.length)for(r=0,e=this.length,i=n;i>e;e++)this[e]=void 0;var u=r,s=n,l=n+u,a=arguments.length-2,c=this.length+a-u,f=l,h=this.length,p=c-this.length;if(p>0)for(e=h;--e>=f;)this[e+p]=this[e];if(0>p)for(e=f;h>e;)this[e+p]=this[e],e++;for(e=s,o=2;arguments.length>o;o)this[e++]=t(this._constructor,arguments[o++]);return this.length=c,this},slice:function(){return y.apply(this,arguments)},sort:function(t){return v.call(this,t),this},reverse:function(){for(var t=y.call(this,0),n=0,r=this.length;r>n;n++)this[n]=t[r-n-1];return this},toString:function(){return""+y.call(this,0)},each:function(t,n){for(var r=0,e=this.length;e>r;r++)t.call(n||this,this[r],r)},where:function(t){for(var r,e=new this.constructor,i=0,o=this.length;o>i;i++)r=this[i],n(r,t)&&(e[e.length++]=r);return e},remove:function(t){for(var r=-1,e=[],i=0,o=this.length;o>i;i++)n(this[i],t)?e.push(this[i]):this[++r]=this[i];for(i=++r;o>i;i++)this[i]=null;return this.length=r,e},first:function(t){if(null==t)return this[0];for(var r=this.length,e=0;-1!==--r;)if(n(this[e++],t))return this[e-1];return null},last:function(t){if(null==t)return this[0];for(var r=this.length;-1!==--r;)if(n(this[r],t))return this[r];return null}};return r}(),i={serialize:function(){return JSON.stringify(this.toArray())},deserialize:function(n){for(var r=0,e=n.length;e>r;r++)this[this.length++]=t(this._constructor,n[r]);return this},del:function(t){if(null==t&&0!==arguments.length)return console.error("Collection.del - selector is specified, but is undefined"),this;if(null==t){for(var n=0,r=this.length;r>n;n++)this[n]=null;return this.length=0,x.prototype.del.call(this),this}var e=this.remove(t);return 0===e.length?this:this.save()},toArray:function(){for(var t=Array(this.length),n=0,r=this.length;r>n;n++)t[n]=this[n];return t}};return r}(),E={deserialize:function(t){"string"==typeof t&&(t=JSON.parse(t));for(var n in t)this[n]=t[n];return this},serialize:function(){return JSON.stringify(this)},fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(t){return(new this).fetch(t)}}},T=function(){var t=function(t){this._route=new S(t)};return l(t,E,b,{fetch:function(t){return w.get(this._route.create(t||this),this),this},save:function(t){w.post(this._route.create(this),this.serialize(),t)},del:function(t){w.del(this._route.create(this),this.serialize(),t)},onSuccess:function(t){var n;try{n=JSON.parse(t)}catch(r){return this.onError(r),void 0}this.deserialize(n),this.resolve(this)},onError:function(t){this.reject({error:t})}}),function(n){return new t(n)}}(),x=function(){var t=function(t){this._route=new S(t)};l(t,E,b,{fetch:function(t){var n=this._route.create(t||this),r=localStorage.getItem(n);if(null==r)return this.resolve(this),this;if(e(r))try{r=JSON.parse(r)}catch(i){this.onError(i)}return this.deserialize(r),this.resolve(this)},save:function(t){var n=this._route.create(this),r=this.serialize();return localStorage.setItem(n,r),t&&t(),this},del:function(t){var n=this._route.create(t||this);return localStorage.removeItem(n),this},onError:function(t){this.reject({error:t})}});var n=function(n){return new t(n)};return n.prototype=t.prototype,n}(),z=function(t){var n,r=t.Base,e=t.Extends,i=t.Static,o=t.Construct,u=null,l=t.Store,a=t.Self,c=t.Override;if(null!=r&&delete t.Base,null!=e&&delete t.Extends,null!=i&&delete t.Static,null!=a&&delete t.Self,null!=o&&delete t.Construct,null!=l&&(null==e?e=l:Array.isArray(e)?e.push(l):e=[e,l],delete t.Store),null!=c&&delete t.Override,void 0===t.toJSON&&(t.toJSON=_.toJSON),null==r&&null==e&&null==a){if(u=null==o?function(){}:o,t.constructor=u.prototype.constructor,null!=i)for(n in i)u[n]=i[n];return u.prototype=t,u}if(u=function(){if(null!=e)for(var t=e instanceof Array,n=t?e.length:1,i=null,u=0;t?n>u:1>u;u++)i=t?e[u]:e,"function"==typeof i&&i.apply(this,arguments);if(null!=r&&r.apply(this,arguments),null!=a)for(var s in a)this[s]=p(a[s],this);if(null!=o){var l=o.apply(this,arguments);if(null!=l)return l}return this},null!=i)for(n in i)u[n]=i[n];return null!=r&&m(u,r),null!=e&&m(u,e),s(t,r,e),d(u,r,e,t,c),t=null,i=null,u};z.bind=function(t){for(var n,r=arguments,e=1,i=arguments.length;i>e;e++)n=r[e],t[n]=t[n].bind(t);return t},z.Remote=T,z.LocalStore=x,z.Collection=A,z.Serializable=g,z.Deferred=b,z.EventEmitter=j,z.validate=O.validate,function(){function t(t,n){if(t.length!==n.length)return!1;for(var r=t.length,e=0;r>e;e++)if(t[e]!==n[e])return!1;return!0}function n(n,r){if(0===r.length)return 0;for(var e=0,i=n.length;i>e;e++)if(t(n[e],r))return e+1;return n.push(r),n.length}function r(t){var r={},e=[];return function(){var i=n(e,arguments);return null==r[i]?r[i]=t.apply(this,arguments):r[i]}}function e(t,n,r){return function(){t[r]=arguments;for(var e,i=0,o=n[r].length;o>i;i++)e=n[r][i],e.apply(this,arguments);n[i]=null,t=null,n=null}}function i(t){var r={},i={},o=[];return function(){var u=Array.prototype.slice.call(arguments),s=u.pop(),l=n(o,u);return r[l]?(s.apply(this,r[l]),void 0):i[l]?(i[l].push(s),void 0):(i[l]=[s],u=Array.prototype.slice.call(u),u.push(e(r,i,l)),t.apply(this,u),void 0)}}z.Fn={memoize:r,memoizeAsync:i}}(),n.Class=z});