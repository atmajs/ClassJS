(function(t,n){"use strict";var e,r,i=!1;"undefined"==typeof exports||null!=t&&t!==exports&&t!==global||(e=global,i=!0),null==e&&(e="undefined"==typeof window?global:window),null==r&&(r=t||e),n(e,r),i&&(module.exports=r.Class)})(this,function(t,n){"use strict";function e(t){return"function"==typeof t}function r(t){return null!=t&&"number"==typeof t.length&&"function"==typeof t.slice}function i(t){return"string"==typeof t}function o(t,n){if(u(t))for(var e=0,r=t.length;r>e;e++)n(t[e],e);else n(t)}function u(t){return null!=t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice}function s(t){return"function"==typeof t?t.prototype:t}function l(t,n,e){var r,i;for(r in t)i=t[r],h(i)&&(null!=n&&h(n.prototype[r])&&f(i,n.prototype[r]),null!=e&&o(e,function(t){t=s(t),h(t[r])&&f(i,t[r])}))}function a(t){"function"==typeof t&&(t=t.prototype);for(var n,e,r=1,i=arguments.length;i>r;r++){n="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(e in n)if("Static"!==e||null==t.Static)t[e]=n[e];else for(e in t.Static)t.Static[e]=t.Static[e]}return t}function c(t,n){for(var e=n.split("."),r=e.length,i=0;r>i;i++){if(null==t)return null;t=t[e[i]]}return t}function h(t){return null==t?!1:"object"!=typeof t?!1:t.constructor===Object}function f(t,n){for(var e in n)null==t[e]&&(t[e]=n[e]);return t}function p(t,n){for(var e in n)n[e]&&(t[e]=n[e]);return t}function v(n){return void 0===n||n===t}function g(t,n){return function(){return d(t,n,arguments)}}function d(t,n,e){switch(e.length){case 1:return t.call(n,e[0]);case 2:return t.call(n,e[0],e[1]);case 3:return t.call(n,e[0],e[1],e[2]);case 4:return t.call(n,e[0],e[1],e[2],e[3]);case 5:return t.call(n,e[0],e[1],e[2],e[3],e[4])}return t.apply(n,e)}function y(n){if(this===J||null==this||this===t){var e=function(t){y.call(this,t)};return e.prototype._props=n,p(e.prototype,y.prototype),e}null!=n&&this.deserialize(n)}function _(){}var m=Array.prototype.slice,S=Array.prototype.sort;"function"!=typeof Array.isArray&&(Array.isArray=function(t){return t instanceof Array?!0:null==t||"object"!=typeof t?!1:void 0!==t.length&&"function"==typeof t.slice});var w=function(){function t(t,n){if(null!=n){"function"==typeof t&&(t=t.prototype),"function"==typeof n&&(n=n.prototype);for(var e in n)t[e]=n[e]}}function n(t,n,e){var r=t[n],i=null==r?function(){}:function(t){return s(t)?d(r,this,t):d(r,this,arguments)};return function(){return this["super"]=i,d(e,this,arguments)}}function e(e,r,u,s,l){var a=s,c=s;if(a.constructor=e.prototype.constructor,null!=u&&(c[i]={},o(u,function(n){t(c[i],n)}),c=c[i]),null!=r&&(c[i]=r.prototype),null!=l)for(var h in l)a[h]=n(a,h,l[h]);e.prototype=a}function r(e,r,i,u,s){if(null!=i&&o(i,function(n){delete n.constructor,t(e,n)}),null!=r){var l=function(){};l.prototype=r.prototype,e.prototype=new l,e.prototype.constructor=e}if(null!=s){var a=e.prototype;for(var c in s)a[c]=n(a,c,s[c])}t(e,u)}var i="__proto__",u=Object.prototype.toString,s=function(t){return"[object Arguments]"===u.call(t)};return"__proto__"in Object.prototype==!0?e:r}(),O=function(t,n){if(null!=n)if("function"!=typeof n){if(Array.isArray(n))for(var e=n.length,r=0;0!==e--;)O(t,n[r++]);else if(n.Static){n=n.Static;for(var i in n)n.hasOwnProperty(i)&&null==t[i]&&(t[i]=n[i])}}else for(var i in n)"function"==typeof n[i]&&n.hasOwnProperty(i)&&null==t[i]&&(t[i]=n[i])},b=function(){var t=Date.prototype.toJSON;return{toJSON:function(){var n,r,i={};for(n in this)if(95!==n.charCodeAt(0)&&"Static"!==n&&"Validate"!==n&&(r=this[n],null!=r)){switch(typeof r){case"function":continue;case"object":var o=r.toJSON;if(o===t)break;if(e(o)){i[n]=r.toJSON();continue}}i[n]=r}return null!=this._id&&(i._id=this._id),i},arrayToJSON:function(){for(var t,n=Array(this.length),r=0,i=this.length;i>r;r++){if(t=this[r],"object"!=typeof t)return n[r]=t,void 0;n[r]=e(t.toJSON)?t.toJSON():b.toJSON.call(t)}return n}}}(),j={};(function(){(function(t){function n(){this._callbacks=[]}function e(t){function e(t){return function(){o+=1,i[t]=Array.prototype.slice.call(arguments),o===u&&r.done(i)}}var r=new n,i=[];if(!t||!t.length)return r.done(i),r;for(var o=0,u=t.length,s=0;u>s;s++)t[s].then(e(s));return r}function r(t,e){var i=new n;return 0===t.length?i.done.apply(i,e):t[0].apply(null,e).then(function(){t.splice(0,1),r(t,arguments).then(function(){i.done.apply(i,arguments)})}),i}function i(t){var n="";if("string"==typeof t)n=t;else{var e=encodeURIComponent;for(var r in t)t.hasOwnProperty(r)&&(n+="&"+e(r)+"="+e(t[r]))}return n}function o(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){t=new ActiveXObject("Microsoft.XMLHTTP")}return t}function u(t,e,r,u){function s(){v.abort(),g.done(h,"",v)}var v,g=new n,d=u&&u["Content-Type"]||p.contentType;try{v=o()}catch(y){return g.done(c,""),g}if(r)if("GET"===t)e+="?"+i(r),r=null;else switch(d){case l:r=i(r);break;case a:try{r=JSON.stringify(r)}catch(_){return g.done(f,""),g}default:r=i(r)}v.open(t,e),r&&v.setRequestHeader("Content-Type",d);for(var m in u)u.hasOwnProperty(m)&&v.setRequestHeader(m,u[m]);var S=p.ajaxTimeout;if(S)var w=setTimeout(s,S);return v.onreadystatechange=function(){if(S&&clearTimeout(w),4===v.readyState){var t=!v.status||(200>v.status||v.status>=300)&&304!==v.status;g.done(t,v.responseText,v)}},v.send(r),g}function s(t){return function(n,e,r){return u(t,n,e,r)}}var l="application/x-www-form-urlencoded",a="application/json",c=1,h=2,f=3;n.prototype.then=function(t,e){var r;return this._isdone?r=t.apply(e,this.result):(r=new n,this._callbacks.push(function(){var n=t.apply(e,arguments);n&&"function"==typeof n.then&&n.then(r.done,r)})),r},n.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var t=0;this._callbacks.length>t;t++)this._callbacks[t].apply(null,arguments);this._callbacks=[]};var p={Promise:n,join:e,chain:r,ajax:u,get:s("GET"),post:s("POST"),put:s("PUT"),del:s("DELETE"),patch:s("PATCH"),ENOXHR:c,ETIMEOUT:h,E_PREPAIR_DATA:f,ajaxTimeout:0,contentType:a};"function"==typeof define&&define.amd?define(function(){return p}):t.promise=p})(this)}).call(j),o(["get"],function(t){j[t]=function(n,e){this.promise[t](n).then(function(t,n,r){return t?(e.onError(t,n,r),void 0):(e.onSuccess(n),void 0)})}}),o(["del","post","put","patch"],function(t){j[t]=function(n,e,r){this.promise[t](n,e).then(function(t,n,e){r(t,n,e)})}}),y.prototype={constructor:y,serialize:function(){return JSON.stringify(this)},deserialize:function(t){if(i(t))try{t=JSON.parse(t)}catch(n){return console.error("<json:deserialize>",t),this}if(!r(t)||!e(this.push)){var o,u,s=this._props;for(o in t){if(null!=s&&(u=s[o],null!=u)){if(e(u)){this[o]=new u(t[o]);continue}var l=u.deserialize;if(e(l)){this[o]=l(t[o]);continue}}this[o]=t[o]}return this}this.length=0;for(var a=0,c=t.length;c>a;a++)this.push(t[a])}};var A=function(){function t(t){this.route=r(t)}function n(t){var n=o.exec(t);return n?{optional:"?"===(n[2]||n[3]),parts:[n[1],n[4]]}:(n=u.exec(t))?{optional:"?"===n[3],parts:[n[1],n[4],n[5]]}:(console.error("Paths breadcrumbs should be matched by regexps"),{parts:[t]})}function e(t,e){for(var r=t.split(e),i=0,o=r.length;o>i;i++)r[i]=n(r[i]);return r}function r(t){var n=/[^\:\{]\?[^:]/.exec(t),r=null;return n&&(n=n.index+1,r=t.substring(n+1),t=t.substring(0,n)),{path:e(t,"/"),query:null==r?null:e(r,"&")}}function i(t,n,e){for(var r,i,o,u=[],s=0,l=t.length;l>s;s++)if(o=t[s],i=o.parts.slice(0),null!=i[1]){if(r=i[1],i[1]=n[r],null!=i[1])u.push(i.join(""));else if(!o.optional)return console.error("Object has no value, for not optional part - ",r),null}else u.push(i[0]);return u.join(e)}t.prototype={constructor:t,create:function(t){var n,e;return n=i(this.route.path,t,"/"),null==n?null:this.route.query&&(e=i(this.route.query,t,"&"),null==e)?null:n+(e?"?"+e:"")},hasAliases:function(t){for(var n,e=0,r=this.route.path.length;r>e;e++)if(n=this.route.path[e].parts[1],n&&null==t[n])return!1;return!0}};var o=/^([^:\?]*)(\??):(\??)([\w]+)$/,u=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return t}();_.prototype={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,defer:function(){this._rejected=null,this._resolved=null},resolve:function(){this._fail=null,this._resolved=arguments;var t,n,e=this._done,r=this._always;if(this._done=null,this._always=null,null!=e){for(t=e.length,n=-1;t>++n;)d(e[n],this,arguments);e.length=0}if(null!=r)for(t=r.length,n=-1;t>++n;)r[n].call(this,this);return this},reject:function(){this._done=null,this._rejected=arguments;var t,n,e=this._fail,r=this._always;if(this._fail=null,this._always=null,null!=e)for(t=e.length,n=-1;t>++n;)d(e[n],this,arguments);if(null!=r)for(t=r.length,n=-1;t>++n;)r[n].call(this,this);return this},resolveDelegate:function(){return g(this.resolve,this)},rejectDelegate:function(){return g(this.reject,this)},done:function(t){return null!=this._resolved?d(t,this,this._resolved):(this._done||(this._done=[])).push(t),this},fail:function(t){return null!=this._rejected?d(t,this,this._rejected):(this._fail||(this._fail=[])).push(t),this},always:function(t){return null!=this._rejected||null!=this._resolved?t.call(this,this):(this._always||(this._always=[])).push(t),this}};var N=function(){function t(){this._listeners={}}return t.prototype={constructor:t,on:function(t,n){return null!=n&&(this._listeners[t]||(this._listeners[t]=[])).push(n),this},once:function(t,n){return null!=n&&(n._once=!0,(this._listeners[t]||(this._listeners[t]=[])).push(n)),this},pipe:function(t){var n,e=this;return function(){n=m.call(arguments),n.unshift(t),d(e.trigger,e,n)}},trigger:function(){var t,n,e=m.call(arguments),r=e.shift(),i=this._listeners[r],o=0;if(null==i)return this;for(n=i.length;n>o;o++)t=i[o],d(t,this,e),t._once===!0&&(i.splice(o,1),o--,n--);return this},off:function(t,n){var e=this._listeners[t];if(null==e)return this;if(1===arguments.length)return e.length=0,this;for(var r=e.length,i=-1;r>++i;)e[i]===n&&(e.splice(i,1),i--,r--);return this}},t}(),T=function(){function t(t,r,i){if(e(r))return r.call(t);var o,u;if(i){for(var s=0,l=i.length;l>s;s++)if(u=i[s],o=n(t,u,r[u]))return o}else for(u in r)if(o=n(t,u,r[u]))return o}function n(t,n,r){if(e(r)===!1)return"<validation> Function expected for "+n;var i=c(t,n);return r.call(t,i)}function r(n){var e,r;return arguments.length>1&&"string"==typeof arguments[1]&&(r=m.call(arguments,1)),null!=n.Validate&&(e=t(n,n.Validate,r))?e:void 0}return{validate:r}}(),J=function(t){var n,e=t.Base,i=t.Extends,o=t.Static,u=t.Construct,s=null,a=t.Store,c=t.Self,h=t.Override;if(null!=e&&delete t.Base,null!=i&&delete t.Extends,null!=o&&delete t.Static,null!=c&&delete t.Self,null!=u&&delete t.Construct,null!=a&&(null==i?i=a:r(i)?i.unshift(a):i=[a,i],delete t.Store),null!=h&&delete t.Override,void 0===t.toJSON&&(t.toJSON=b.toJSON),null==e&&null==i&&null==c){if(s=null==u?function(){}:u,t.constructor=s.prototype.constructor,null!=o)for(n in o)s[n]=o[n];return s.prototype=t,s}if(s=function(){if(null!=i)for(var t=i instanceof Array,n=t?i.length:1,r=0,o=null;n>r;r++)o=t?i[r]:i,"function"==typeof o&&d(o,this,arguments);if(null!=e&&d(e,this,arguments),null!=c&&v(this)===!1)for(var s in c)this[s]=g(c[s],this);if(null!=u){var l=d(u,this,arguments);if(null!=l)return l}return this},null!=o)for(n in o)s[n]=o[n];return null!=e&&O(s,e),null!=i&&O(s,i),l(t,e,i),w(s,e,i,t,h),t=null,o=null,s};J.bind=function(t){for(var n,e=arguments,r=1,i=arguments.length;i>r;r++)n=e[r],t[n]=t[n].bind(t);return t},J.Serializable=y,J.Deferred=_,J.EventEmitter=N,J.validate=T.validate,J.Collection=function(){function t(t,n){return n instanceof t?n:new t(n)}function n(t,n){return n._ctor=t,a(n,r,e),J(n)}var e=function(){function n(t,n){if(null==n)return!1;if("function"==typeof n)return n(t);if("object"==typeof n){if(t.constructor===n.constructor&&t.constructor!==Object)return t===n;var e,r;for(var i in n){if(e=t[i],r=n[i],"string"==typeof r){var o=r[0],u=1;if("<"===o||">"===o)switch("="===r[1]&&(o+="=",u++),r=r.substring(u),o){case"<":if(e>=r)return!1;continue;case"<=":if(e>r)return!1;continue;case">":if(r>=e)return!1;continue;case">=":if(r>e)return!1;continue}}if(e!=r)return!1}return!0}return console.warn("No valid matcher",n),!1}var e={length:0,push:function(){for(var n=0,e=arguments.length;e>n;n++)this[this.length++]=t(this._ctor,arguments[n]);return this},pop:function(){var t=this[--this.length];return this[this.length]=null,t},shift:function(){if(0===this.length)return null;for(var t=this[0],n=this.length-1,e=0;n>e;e++)this[e]=this[e+1];return this[n]=null,this.length--,t},unshift:function(n){this.length++;for(var e=this.length;--e;)this[e]=this[e-1];return this[0]=t(this._ctor,n),this},splice:function(n,e){var r,i,o;if(n>=this.length)for(e=0,r=this.length,i=n;i>r;r++)this[r]=void 0;var u=e,s=n,l=n+u,a=arguments.length-2,c=this.length+a-u,h=l,f=this.length,p=c-this.length;if(p>0)for(r=f;--r>=h;)this[r+p]=this[r];if(0>p)for(r=h;f>r;)this[r+p]=this[r],r++;for(r=s,o=2;arguments.length>o;o)this[r++]=t(this._ctor,arguments[o++]);return this.length=c,this},slice:function(){return d(m,this,arguments)},sort:function(t){return S.call(this,t),this},reverse:function(){for(var t=m.call(this,0),n=0,e=this.length;e>n;n++)this[n]=t[e-n-1];return this},toString:function(){return""+m.call(this,0)},each:function(t,n){for(var e=0,r=this.length;r>e;e++)t.call(n||this,this[e],e);return this},where:function(t){for(var e,r=new this.constructor,i=0,o=this.length;o>i;i++)e=this[i],n(e,t)&&(r[r.length++]=e);return r},remove:function(t){for(var e=-1,r=[],i=0,o=this.length;o>i;i++)n(this[i],t)?r.push(this[i]):this[++e]=this[i];for(i=++e;o>i;i++)this[i]=null;return this.length=e,r},first:function(t){if(null==t)return this[0];var n=this.indexOf(t);return-1!==n?this[n]:null},last:function(t){if(null==t)return this[this.length-1];var n=this.lastIndexOf(t);return-1!==n?this[n]:null},indexOf:function(t,e){if(null==t)return-1;if(null!=e){if(0>e&&(e=0),e>=this.length)return-1}else e=0;for(var r=this.length;r>e;e++)if(n(this[e],t))return e;return-1},lastIndexOf:function(t,e){if(null==t)return-1;if(null!=e){if(e>=this.length&&(e=this.length-1),0>e)return-1}else e=this.length-1;for(;e>-1;e--)if(n(this[e],t))return e;return-1}};return e}(),r={toArray:function(){for(var t=Array(this.length),n=0,e=this.length;e>n;n++)t[n]=this[n];return t},toJSON:b.arrayToJSON};return n}();var x={fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(t){return(new this).fetch(t)}}};J.Remote=function(){function t(t,e){var r;try{r=JSON.parse(e)}catch(i){return n(t,i),void 0}t.deserialize(r),t.resolve(t)}function n(t,n){t.reject(n)}function e(t,e,r){return function(u,s,l){var a=-1!==l.getResponseHeader(i).indexOf(o);if(a)try{s=JSON.parse(s)}catch(u){return console.error("<XHR> invalid json response",s),n(t,s,l)}return e&&e(u,s),u?n(t,s,l):"save"===r?(t.deserialize(s),t.resolve(t)):(t.resolve(s),void 0)}}var i="content-type",o="json",u=function(t){this._route=new A(t)};return a(u,x,y,_,{serialize:function(){return r(this)?b.arrayToJSON.call(this):b.toJSON.call(this)},fetch:function(t){return j.get(this._route.create(t||this),this),this},save:function(t){var n=this.serialize(),r=this._route.create(this),i=this._route.hasAliases(this)?"put":"post";return this.defer(),j[i](r,n,e(this,t,"save")),this},patch:function(t){return obj_patch(t),this.defer(),j.patch(path,json,e(this,callback)),this},del:function(t){var n=this.serialize(),r=this._route.create(this);return this.defer(),j.del(r,n,e(this,t)),this},onSuccess:function(n){t(this,n)},onError:function(t,e,r){n(this,e,r)}}),function(t){return new u(t)}}(),J.LocalStore=function(){function t(t,n){var e=t.create(n);localStorage.removeItem(e)}var n=function(t){this._route=new A(t)};a(n,x,y,_,{serialize:function(){var t=r(this)?b.arrayToJSON.call(this):b.toJSON.call(this);return JSON.stringify(t)},fetch:function(t){var n=this._route.create(t||this),e=localStorage.getItem(n);if(null==e)return this.resolve(this),this;if(i(e))try{e=JSON.parse(e)}catch(r){this.onError(r)}return this.deserialize(e),this.resolve(this)},save:function(t){var n=this._route.create(this),e=this.serialize();return localStorage.setItem(n,e),t&&t(),this},del:function(n){if(null==n&&0!==arguments.length)return console.error("<localStore:del> - selector is specified, but is undefined"),this;if(u(this)===!1)return t(this._route,n||this),this;if(null==n){for(var e=0,r=this.length;r>e;e++)this[e]=null;return this.length=0,t(this._route,this),this}var i=this.remove(n);return 0===i.length?this:this.save()},onError:function(t){this.reject({error:t})}});var e=function(t){return new n(t)};return e.prototype=n.prototype,e}(),function(){function t(t,n){if(t.length!==n.length)return!1;for(var e=t.length,r=0;e>r;r++)if(t[r]!==n[r])return!1;return!0}function n(n,e){if(0===e.length)return 0;for(var r=0,i=n.length;i>r;r++)if(t(n[r],e))return r+1;return n.push(e),n.length}function e(t){var e={},r=[];return function(){var i=n(r,arguments);return null==e[i]?e[i]=d(t,this,arguments):e[i]}}function r(t,n,e){return function(){t[e]=arguments;for(var r,i=0,o=n[e].length;o>i;i++)r=n[e][i],d(r,this,arguments);n[i]=null,t=null,n=null}}function i(t){var e={},i={},o=[];return function(){var u=m.call(arguments),s=u.pop(),l=n(o,u);return e[l]?(d(s,this,e[l]),void 0):i[l]?(i[l].push(s),void 0):(i[l]=[s],u=m.call(u),u.push(r(e,i,l)),d(t,this,u),void 0)}}J.Fn={memoize:e,memoizeAsync:i}}(),n.Class=J});